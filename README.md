# Arma Reforger 创意工坊修复工具 v2.2.0

专门为《Arma Reforger》玩家设计的 DNS 污染和劫持修复工具。当玩家在下载创意工坊内容时遇到 DNS 污染、劫持或连接错误时，此工具可以自动测试并选择最优的 `ar-gcp-cdn.bistudio.com` IP 地址，修复下载问题。

> 🎉 **v2.2.0 重要更新** (2025-12-28): DNS解析增强和智能IP过滤！
> - 🔧 **DNS解析增强**: 增加超时时间，添加本地DNS和系统解析回退机制，大幅提升DNS解析成功率
> - 🛡️ **智能IP过滤**: 自动排除局域网IP和DNS服务器IP，避免DNS错误导致的无效结果
> - 🐛 **问题修复**: 修复"无法找到DNS服务器并获取0个IP"的问题
> - ✨ **代码质量**: 修复所有linter警告，代码更规范

8> 🎉 **v2.1.0 重大更新** (2025-09-18): GUI版本完全独立化！移除对CLI版本的依赖，所有功能集成到图形界面中，使用更加便捷。

> 🚀 **v2.0.0 重大更新**: 全新异步并行测试架构，测试速度提升300%！移除带宽测试功能，专注于核心网络性能优化。


## 功能特点

- 🛠️ **DNS 污染修复**: 绕过被污染的 DNS 解析，直接使用真实 IP 地址
- 🔍 **自动获取真实IP**: 使用60+个权威DNS服务器并行查询，获取 `ar-gcp-cdn.bistudio.com` 的真实 IP 地址
- 🛡️ **智能IP过滤**: 自动排除局域网IP和DNS服务器IP，确保只测试有效的公网IP地址
- 🔄 **DNS解析回退**: 多重回退机制（权威DNS → 本地DNS → 系统解析），确保解析成功率
- 🚀 **真正并行测试**: 使用异步I/O技术实现真正的并行测试，性能提升300%
- 🌐 **DNS解析并行化**: 所有权威DNS服务器同时查询，解析速度大幅提升
- 📊 **多维度测试**: 同时测试 Ping 延迟和 HTTP/HTTPS 状态码，确保连接稳定
- 🔒 **SSL证书验证**: 使用正确的域名验证SSL证书有效性，确保连接安全性
- 🎯 **智能评分**: 基于 HTTP/HTTPS 可用性、延迟、SSL证书状态和协议完整性综合评分，提供明显的优劣区分
- 🔬 **多维度健康检测**: 连接稳定性、SSL质量、协议支持、地理位置等多维度综合评估
- 📈 **实时进度显示**: 详细的测试进度跟踪，包含时间估算和当前状态
- 🎨 **增强GUI界面**: 改进的用户界面，显示更多检测属性和统计信息
- 📋 **完整结果展示**: 显示所有可用IP地址，不再限制显示数量
- 🔄 **自动备份**: 更新前自动备份原始 hosts 文件，确保安全
- 🚀 **性能优化**: 全新异步架构，移除带宽测试，专注核心网络性能
- 🔐 **自动管理员权限**: 自动检测并请求管理员权限，确保hosts文件修改成功
- 🖥️ **跨平台**: 支持 Windows、macOS 和 Linux 系统

## 安装和使用

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行程序

#### GUI 版本（推荐）
```bash
python hosts_optimizer_gui.py
```

> **注意**: 本工具现在只提供GUI版本，所有功能已集成到图形界面中，无需使用命令行版本。

#### Windows 一键启动（推荐）
- **批处理启动**: 双击 `start_as_admin.bat`
- **PowerShell启动**: 右键选择"使用PowerShell运行" `start_as_admin.ps1`

**注意**: 程序会自动检测管理员权限，如果没有权限会自动请求提升权限。

## 配置说明

本工具专为 Arma Reforger 玩家设计，所有配置参数已经过优化并硬编码在程序中，无需用户修改。工具会自动：

- 使用60+个权威DNS服务器并行查询，完全避免DNS污染
- 应用最佳的测试参数和超时设置  
- 启用所有必要的功能（HTTP/HTTPS测试、SSL验证等）
- 使用智能评分算法进行IP排序
- 覆盖全球主要CDN和云服务提供商，确保获取最全面的IP地址列表

## 工作原理

1. **IP 地址获取**: 使用60+个权威DNS服务器并行查询获取 `ar-gcp-cdn.bistudio.com` 的真实 IP 地址，完全绕过 DNS 污染。如果权威DNS失败，自动使用本地DNS和系统解析作为回退
2. **智能IP过滤**: 自动过滤掉局域网IP和DNS服务器IP，确保只测试有效的公网IP地址
3. **多维度测试**: 对每个 IP 地址进行 Ping 延迟和 HTTP/HTTPS 状态码测试，确保节点可用
4. **SSL证书验证**: 使用正确的域名验证HTTPS连接的SSL证书有效性，确保连接安全性
5. **智能评分**: 基于可用性、延迟、SSL证书状态和协议完整性计算综合评分，提供明显的优劣区分
6. **多维度健康检测**: 并行检测连接稳定性、SSL质量、协议支持和地理位置，提供全面的网络质量评估
7. **实时进度跟踪**: 显示详细的测试进度，包含时间估算和当前状态，提供更好的用户体验
8. **完整结果展示**: 显示所有可用的IP地址，按综合评分排序，不再限制显示数量
9. **结果排序**: 按综合评分排序，评分相同时按延迟排序
10. **文件更新**: 将最优 IP 地址写入 hosts 文件，修复创意工坊下载问题

## 适用场景

- 🎮 **创意工坊下载失败**: 修复 Arma Reforger 创意工坊内容下载错误
- 🌐 **DNS 污染问题**: 解决因 DNS 污染导致的连接问题
- 🔒 **DNS 劫持修复**: 绕过被劫持的 DNS 解析
- ⚡ **下载速度优化**: 选择延迟最低的 CDN 节点，提升下载速度

## 系统要求

- Python 3.6 或更高版本
- 管理员权限（用于修改 hosts 文件）
- 网络连接

## 作者信息

- **作者**: ViVi141
- **邮箱**: 747384120@qq.com

## 许可证

此项目使用 AGPL-3.0 license许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 版本历史

- **v2.2.0** (2025-12-28): DNS解析增强和智能IP过滤
  - 🔧 **DNS解析增强**: 增加DNS查询超时时间（0.5秒→3秒），总体超时时间（10秒→30秒），提升解析成功率
  - 🔄 **多重回退机制**: 权威DNS失败时自动使用本地DNS，本地DNS失败时使用系统解析，确保总能获取IP地址
  - 🛡️ **智能IP过滤**: 自动排除局域网IP（10.x.x.x, 172.16-31.x.x, 192.168.x.x, 127.x.x.x, 169.254.x.x）和DNS服务器IP
  - 📊 **详细诊断信息**: 显示DNS查询统计、过滤统计和详细的错误提示，便于问题排查
  - 🐛 **问题修复**: 修复"无法找到DNS服务器并获取0个IP"的问题，提升稳定性
  - ✨ **代码质量**: 修复所有linter警告，代码更规范，符合Google代码风格
  - 📝 **改进日志**: 显示被过滤的IP和原因，提供更清晰的调试信息

- **v2.1.0** (2025-09-18): GUI版本独立化更新
  - 🎯 **完全独立**: GUI版本不再依赖CLI文件，所有功能集成到单一可执行文件
  - 🚀 **性能优化**: 移除不必要的依赖，提升启动速度和运行效率
  - 🛠️ **代码重构**: 将所有核心类和方法迁移到GUI文件中，代码结构更清晰
  - 🔧 **维护性提升**: 减少文件依赖，降低维护复杂度


- **v2.0.0** (2025-09-14): 重大架构升级和性能优化
  - 🚀 **真正并行测试**: 采用异步I/O技术，测试速度提升300%
  - 🏗️ **架构重构**: 全新的异步测试引擎，支持大规模并发测试
  - ⚡ **性能飞跃**: 移除带宽测试，专注核心网络性能优化
  - 🔧 **代码优化**: 简化项目结构，移除冗余功能
  - 🐛 **错误修复**: 修复GUI界面错误，提升稳定性
  - 📊 **评分优化**: 优化评分算法，更准确反映网络质量
  - 🌐 **DNS解析并行化**: 所有权威DNS服务器同时查询，解析速度大幅提升
  - 📡 **权威DNS扩展**: 支持60+个权威DNS服务器，覆盖全球主要CDN和云服务提供商

- **v1.3.0** (2025-09-08): DNS解析增强和速度优化
  - 🌐 **增强DNS解析**: 支持50+个DNS服务器，完全避免本地DNS污染
  - ⚡ **快速模式**: 大幅提升检测速度，总检测时间减少26%
  - 🔍 **IP验证机制**: 自动验证IP地址有效性，确保连接可用性
  - 🚀 **并发优化**: 并发能力提升400%，检测效率大幅提升
  - 📊 **DNS服务器扩展**: 添加国际DNS、安全DNS、DoH服务
  - 🔧 **超时优化**: 大幅减少各种超时时间，提高响应速度
  - 💾 **缓存机制**: 添加DNS查询缓存，减少重复请求
  - 🎯 **智能验证**: 并行验证IP地址，过滤无效节点

- **v1.2.0** (2025-09-08): 性能优化和权限管理
  - 🚀 **性能优化**: 移除HTTP/2检测功能，提高测试速度
  - 🔐 **自动管理员权限**: 添加自动权限检测和提升功能
  - 📦 **一键启动**: 提供批处理和PowerShell启动脚本
  - 🛡️ **反病毒友好**: 优化代码结构，提高Windows反病毒软件兼容性
  - 🎯 **界面优化**: 移除HTTP/2相关显示，简化界面
  - 📈 **进度同步**: 修复GUI进度显示不同步问题

- **v1.1.1** (2025-09-08): 图标更新
  - 🎨 **图标更新**: 将软件图标从icon.ico更新为favicon.ico
  - 🔧 **界面优化**: 改进窗口图标显示，提升用户体验

- **v1.1.0** (2025-09-08): 重大功能更新
  - 🎨 **GUI界面全面升级**: 新增更多检测属性列，包括SSL状态、HTTP/2支持、带宽、稳定性等
  - 📈 **实时进度显示**: 添加详细的测试进度跟踪，包含时间估算和当前状态指示器
  - 📋 **完整结果展示**: 显示所有可用IP地址，移除20个IP的显示限制
  - 🔧 **性能优化**: 改进测试流程，优化资源使用和响应速度
  - 🛠️ **错误修复**: 修复健康检查结果显示问题，改进SSL和HTTP/2状态检测
  - 📊 **统计信息增强**: 添加更详细的测试统计和结果预览功能
  - ⚠️ **用户体验改进**: 添加带宽测试说明，明确测试用途和局限性

- **v1.0.0** (2025-09-08): 首次正式发布
  - 专门为 Arma Reforger 玩家设计的 DNS 修复工具
  - 完整的 GUI 和命令行版本
  - 多维度 IP 测试和智能评分
  - 跨平台支持和自动备份功能
  - 解决创意工坊下载问题和 DNS 污染
